<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScrollSpy Example</title>
    <style>
        /* CSS Styles */
        body {
            font-family: sans-serif;
            margin: 0;
            padding-top: 60px; /* Add padding to prevent content from hiding under fixed nav */
            position: relative; /* Needed for offset calculation */
        }

        #mainNav {
            position: fixed; /* Keep nav visible */
            top: 0;
            left: 0;
            width: 100%;
            background-color: #333;
            padding: 10px 0;
            z-index: 1000; /* Ensure nav stays on top */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); /* Optional: subtle shadow */
        }

        #mainNav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
        }

        #mainNav li {
            margin: 0 15px;
        }

        #mainNav a {
            color: #f0f0f0;
            text-decoration: none;
            padding: 8px 15px; /* Slightly larger padding */
            border-radius: 4px; /* Apply radius always for consistency */
            transition: color 0.3s ease, background-color 0.3s ease; /* Smooth transition */
            display: inline-block; /* Ensures padding applies correctly */
        }

        #mainNav a:hover,
        #mainNav a.active { /* Style for the active link */
            color: #333;
            background-color: #fff;
        }

        section {
            padding: 80px 20px; /* Increased padding */
            min-height: 600px; /* Make sections taller */
            border-bottom: 1px solid #eee;
        }

        /* Alternate background colors for sections */
        #section1 { background-color: #f8f9fa; }
        #section2 { background-color: #e9ecef; }
        #section3 { background-color: #f8f9fa; }
        #section4 { background-color: #e9ecef; }


        h2 {
            margin-top: 0;
            color: #343a40; /* Darker heading color */
            border-bottom: 2px solid #007bff; /* Accent border */
            padding-bottom: 10px;
            display: inline-block; /* Make border fit content */
        }

        p {
            line-height: 1.6; /* Improve readability */
            color: #495057; /* Slightly softer text color */
        }

        /* Add some more content for better scrolling demo */
        section p:last-of-type {
            margin-bottom: 200px; /* Add extra space at the end of paragraphs */
        }
    </style>
</head>
<body>

    <!-- Navigation Bar -->
    <nav id="mainNav">
        <ul>
            <li><a href="#section1">Section 1</a></li>
            <li><a href="#section2">Section 2</a></li>
            <li><a href="#section3">Section 3</a></li>
            <li><a href="#section4">Section 4</a></li>
        </ul>
    </nav>

    <!-- Content Sections -->
    <section id="section1">
        <h2>Section 1</h2>
        <p>Welcome to the first section. Scroll down to see the ScrollSpy feature in action. Notice how the navigation link highlights as you enter a new section.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet.</p>
        <p>Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed augue semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.</p>
        <p>Curabitur sodales ligula in libero. Sed dignissim lacinia nunc. Curabitur tortor. Pellentesque nibh. Aenean quam. In scelerisque sem at dolor. Maecenas mattis. Sed convallis tristique sem. Proin ut ligula vel nunc egestas porttitor.</p>
    </section>

    <section id="section2">
        <h2>Section 2</h2>
        <p>This is the second section. The corresponding link in the navigation bar should now be active.</p>
        <p>Morbi lectus risus, iaculis vel, suscipit quis, luctus non, massa. Fusce ac turpis quis ligula lacinia aliquet. Mauris ipsum. Nulla metus metus, ullamcorper vel, tincidunt sed, euismod in, nibh.</p>
        <p>Quisque volutpat condimentum velit. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Nam nec ante. Sed lacinia, urna non tincidunt mattis, tortor neque adipiscing diam, a cursus ipsum ante quis turpis.</p>
        <p>Nulla facilisi. Ut fringilla. Suspendisse potenti. Nunc feugiat mi a tellus consequat imperdiet. Vestibulum sapien. Proin quam. Etiam ultrices. Suspendisse in justo eu magna luctus suscipit.</p>
    </section>

    <section id="section3">
        <h2>Section 3</h2>
        <p>You've reached the third section. Check the navigation bar again!</p>
        <p>Sed lectus. Integer euismod lacus luctus magna. Quisque cursus, metus vitae pharetra auctor, sem massa mattis sem, at interdum magna augue eget diam. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Morbi lacinia molestie dui.</p>
        <p>Praesent blandit dolor. Sed non quam. In vel mi sit amet augue congue elementum. Morbi in ipsum sit amet pede facilisis laoreet. Donec lacus nunc, viverra nec, blandit vel, egestas et, augue. Vestibulum tincidunt malesuada tellus.</p>
        <p>Ut ultrices ultrices enim. Curabitur sit amet mauris. Morbi in dui quis est pulvinar ullamcorper. Nulla facilisi. Integer lacinia sollicitudin massa. Cras metus. Sed aliquet risus a tortor.</p>
    </section>

    <section id="section4">
        <h2>Section 4</h2>
        <p>This is the final section of this demonstration page.</p>
        <p>Integer id quam. Morbi mi. Quisque nisl felis, venenatis tristique, dignissim in, ultrices sit amet, augue. Proin sodales libero eget ante. Nulla quam. Aenean laoreet. Vestibulum nisi lectus, commodo ac, facilisis ac, ultricies eu, pede.</p>
        <p>Ut orci risus, accumsan porttitor, cursus quis, aliquet eget, justo. Sed pretium blandit orci. Ut eu diam at pede suscipit sodales. Aenean lectus elit, fermentum non, convallis id, sagittis at, neque.</p>
        <p>Nullam mauris orci, aliquet et, iaculis et, viverra vitae, ligula. Nulla ut felis in purus aliquam imperdiet. Maecenas aliquet mollis lectus. Vivamus consectetuer risus et tortor. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio.</p>
    </section>

    <script>
        // JavaScript Logic
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('#mainNav a');
            // Adjust this value based on your fixed header height or desired trigger point
            // It should be slightly more than the padding-top of the body or height of the nav
            const offset = 65;

            function changeActiveLink() {
                let currentSectionId = '';
                // Calculate the trigger point by adding the offset to the current scroll position
                const scrollPosition = window.scrollY + offset;

                sections.forEach(section => {
                    // Check if the scroll position is within the bounds of the current section
                    // section.offsetTop is the distance from the top of the document to the top of the section
                    // section.offsetHeight is the height of the section including padding and border
                    if (scrollPosition >= section.offsetTop &&
                        scrollPosition < section.offsetTop + section.offsetHeight) {
                        currentSectionId = section.getAttribute('id');
                    }
                });

                // Edge case: Handle reaching the very bottom of the page
                // If the bottom of the viewport is at or past the bottom of the document body
                // force the last section to be active. Added a small tolerance (e.g., 5 pixels).
                if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 5) {
                     const lastSection = sections[sections.length - 1];
                     if (lastSection) {
                         currentSectionId = lastSection.getAttribute('id');
                     }
                }

                // Update the active class on navigation links
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    // Construct the expected href value (e.g., "#section1")
                    const linkHref = `#${currentSectionId}`;
                    if (link.getAttribute('href') === linkHref) {
                        link.classList.add('active');
                    }
                });

                 // Edge case: Handle being at the very top of the page before the first section's offsetTop
                 // If no section is currently matched and we are scrolled near the top,
                 // default to activating the first link if it exists.
                 if (!currentSectionId && sections.length > 0 && window.scrollY < sections[0].offsetTop - offset) {
                     const firstLink = document.querySelector(`#mainNav a[href="#${sections[0].id}"]`);
                     if (firstLink) {
                         // Remove active from others first to be safe
                         navLinks.forEach(link => link.classList.remove('active'));
                         firstLink.classList.add('active');
                     }
                 }
            }

            // Add smooth scrolling on link click
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault(); // Prevent the default anchor jump behavior
                    const targetId = this.getAttribute('href'); // Get the href value (e.g., "#section1")
                    const targetElement = document.querySelector(targetId); // Find the target section element

                    if (targetElement) {
                        // Calculate the position to scroll to.
                        // targetElement.offsetTop gives the distance from the top of the document.
                        // Subtract the offset to account for the fixed header height,
                        // ensuring the section title appears just below the header.
                        // A small adjustment (e.g., -5) can fine-tune the final position.
                        const offsetPosition = targetElement.offsetTop - offset + 5;

                        window.scrollTo({
                            top: offsetPosition,
                            behavior: 'smooth' // Use the browser's smooth scrolling animation
                        });
                    }
                });
            });


            // Listen for scroll events on the window
            window.addEventListener('scroll', changeActiveLink);

            // Initial check when the page loads to set the correct active link
            // in case the page is loaded with a hash fragment or already scrolled.
            changeActiveLink();
        });
    </script>
</body>
</html>
